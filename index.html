<!DOCTYPE html>
<html lang="es" data-theme="dark">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />

  <title>Andr√©s S√°nchez ¬∑ Perfil</title>
  <meta name="description" content="Sitio personal de Andr√©s S√°nchez: perfil, experiencia, proyectos, stack y contacto." />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=VT323&display=swap"
    rel="stylesheet" />
 <link rel="stylesheet" href="/andres-dat/styles/styles.css">

</head>

<body>
  <a class="skip" href="#main">Saltar al contenido</a>

  <div class="app-skeleton" id="top">
    <header class="app-header">
      <a class="brand" href="#top" aria-label="Inicio">
        <span class="brand__title">C√âSAR REYES</span>
        <span class="brand__tag">DATA ¬∑ IA ¬∑ AUTOMATION</span>
      </a>

      <span class="hint-pill">U: Actions ¬∑ 1‚Äì9: Secciones ¬∑ M: Memento ¬∑ C: CV</span>
    </header>

    <div class="app-container">
      <!-- Left rail -->
      <aside>
        <div class="pad">
          <div class="pad__body pad__scroll">
            <div class="nav-section">
              <div class="nav-section__header">
                <h2 class="nav-section__title">Secciones</h2>
              </div>

              <ul class="nav-rail" id="rail">
                <li>
                  <button type="button" data-go="about">
                    <span>Sobre m√≠</span><span class="badge">1</span>
                  </button>
                </li>
                <li>
                  <button type="button" data-go="stack">
                    <span>Stack</span><span class="badge">2</span>
                  </button>
                </li>
                <li>
                  <button type="button" data-go="experience">
                    <span>Experiencia</span><span class="badge">3</span>
                  </button>
                </li>
                <li>
                  <button type="button" data-go="projects">
                    <span>Proyectos</span><span class="badge">4</span>
                  </button>
                </li>
                <li>
                  <button type="button" data-go="education">
                    <span>Educaci√≥n</span><span class="badge">5</span>
                  </button>
                </li>
                <li>
                  <button type="button" data-go="certs">
                    <span>Certificaciones</span><span class="badge">6</span>
                  </button>
                </li>
                <li>
                  <button type="button" data-go="contact">
                    <span>Contacto</span><span class="badge">7</span>
                  </button>
                </li>
                <li>
                  <button type="button" data-go="instagram">
                    <span>Instagram</span><span class="badge">8</span>
                  </button>
                </li>
                <li>
                  <button type="button" data-go="spotify">
                    <span>Spotify</span><span class="badge">9</span>
                  </button>
                </li>
              </ul>
            </div>

            <div class="divider"></div>

            <h3 class="section-title" style="font-size: 1.05rem">Buscar</h3>
            <p class="muted" style="margin-bottom: 10px">
              B√∫squeda en skills y certificaciones.
            </p>
            <div class="form-control">
              <input id="search" type="text" placeholder="python, power bi, QA, ..." autocomplete="off" />
            </div>

            <div class="divider"></div>

            <button class="cyber-btn" type="button" aria-label="Actions" popovertarget="actions"
              popovertargetaction="show" id="actions-btn">
              <span class="backdrop"><span class="corner"></span></span>
              <kbd>U</kbd>
              <span>Actions</span>

              <span class="glitch" aria-hidden="true">
                <span class="backdrop"><span class="corner"></span></span>
                <kbd>U</kbd>
                <span class="letters">
                  <span>A</span><span>c</span><span>t</span><span>i</span><span>o</span><span>n</span><span>s</span>
                </span>
              </span>
            </button>

            <div style="height: 10px"></div>

            <button class="cyber-btn" type="button" aria-label="Memento Mori" popovertarget="memento"
              popovertargetaction="show" id="memento-btn-left" style="color: var(--colors-tertiary--500)">
              <span class="backdrop" style="box-shadow: 0 0 18px rgba(254, 211, 63, 0.22)">
                <span class="corner"></span>
              </span>
              <kbd style="background: var(--colors-tertiary--500)">M</kbd>
              <span>Memento Mori</span>

              <span class="glitch" aria-hidden="true" style="color: var(--colors-tertiary--500)">
                <span class="backdrop" style="box-shadow: 0 0 18px rgba(254, 211, 63, 0.22)">
                  <span class="corner"></span>
                </span>
                <kbd style="background: var(--colors-tertiary--500)">M</kbd>
                <span class="letters">
                  <span>M</span><span>e</span><span>m</span><span>e</span><span>n</span><span>t</span><span>o</span>
                </span>
              </span>
            </button>

            <div style="height: 10px"></div>

            <button class="cyber-btn" type="button" aria-label="Hoja de vida" popovertarget="cv"
              popovertargetaction="show" id="cv-btn-left" style="color: var(--colors-tertiary--500)">
              <span class="backdrop" style="box-shadow: 0 0 18px rgba(254, 211, 63, 0.22)">
                <span class="corner"></span>
              </span>
              <kbd style="background: var(--colors-tertiary--500)">C</kbd>
              <span>CV / Imprimir</span>

              <span class="glitch" aria-hidden="true" style="color: var(--colors-tertiary--500)">
                <span class="backdrop" style="box-shadow: 0 0 18px rgba(254, 211, 63, 0.22)">
                  <span class="corner"></span>
                </span>
                <kbd style="background: var(--colors-tertiary--500)">C</kbd>
                <span class="letters">
                  <span>C</span><span>V</span><span>
                  </span><span>P</span><span>r</span><span>i</span><span>n</span><span>t</span>
                </span>
              </span>
            </button>
          </div>
        </div>
      </aside>

      <!-- Center -->
      <main id="main">
        <div class="pad">
          <div class="pad__body">
            <div id="stage">
              <!-- ABOUT -->
              <section class="page is-active" id="about" data-page>
                <h1 class="hero-title" id="name">Cargando‚Ä¶</h1>
                <p class="hero-meta">
                  <span>üíº <strong id="headline">‚Äî</strong></span>
                  <span>üìç <strong id="location">‚Äî</strong></span>
                  <span>‚ö° <strong id="focus">Automatizaci√≥n ¬∑ Datos ¬∑ IA</strong></span>
                </p>

                <div class="divider"></div>

                <p class="muted" id="summary" style="font-size: 1.05rem">
                  Cargando resumen‚Ä¶
                </p>

                <div class="divider"></div>

                <div class="grid-2">
                  <div class="item">
                    <h4>Enfoque actual</h4>
                    <p>
                      Ingenier√≠a en Datos e IA (UAO) + automatizaci√≥n de procesos y
                      mejora continua (experiencia industrial).
                    </p>
                  </div>
                  <div class="item">
                    <h4>Highlights</h4>
                    <ul class="detail-list">
                      <li>Implement√© un aplicativo low-code (~1300 usuarios).</li>
                      <li>1er lugar Rally Latinoamericano de Innovaci√≥n (UAO).</li>
                      <li>Ruta BI/Analytics (Power BI, DAX, Tableau, Looker, Excel).</li>
                    </ul>
                  </div>
                </div>
              </section>

              <!-- STACK -->
              <section class="page" id="stack" data-page>
                <h2 class="section-title">Stack</h2>
                <p class="muted">Skills (LinkedIn) + skills clave.</p>

                <div class="divider"></div>

                <div class="grid-2">
                  <div>
                    <h3 class="section-title" style="font-size: 1.05rem">
                      Skills (LinkedIn)
                    </h3>
                    <ul id="skills" class="chip-list" style="margin-top: 10px"></ul>
                    <p class="muted" id="skills-empty" style="display: none; margin-top: 10px">
                      No hay skills para mostrar.
                    </p>
                  </div>

                  <div>
                    <h3 class="section-title" style="font-size: 1.05rem">
                      Skills clave
                    </h3>
                    <ul class="chip-list" style="margin-top: 10px" id="core-skills">
                      <li class="chip">Python</li>
                      <li class="chip">POO</li>
                      <li class="chip">SQL</li>
                      <li class="chip">Power BI</li>
                      <li class="chip">DAX</li>
                      <li class="chip">Tableau</li>
                      <li class="chip">Looker Studio</li>
                      <li class="chip">Excel</li>
                      <li class="chip">QA & testing</li>
                      <li class="chip">Git / GitHub</li>
                      <li class="chip">HTML / CSS</li>
                      <li class="chip">Low-code</li>
                    </ul>

                    <div class="divider"></div>

                    <div class="item">
                      <h4>Soft skills & idiomas</h4>
                      <p>
                        Trabajo en equipo ¬∑ Decisiones basadas en datos ¬∑ Adaptabilidad
                        y gesti√≥n del cambio ¬∑ Comunicaci√≥n clara y asertiva ¬∑ Proactividad
                        y aprendizaje continuo ¬∑ Atenci√≥n al detalle y enfoque en la calidad.
                      </p>
                      <p style="margin-top: 10px" class="muted">
                        <strong>Espa√±ol:</strong> nativo ¬∑ <strong>Ingl√©s:</strong> intermedio (B1‚ÄìB2)
                      </p>
                    </div>
                  </div>
                </div>
              </section>

              <!-- EXPERIENCE -->
              <section class="page" id="experience" data-page>
                <h2 class="section-title">Experiencia</h2>
                <p class="muted">Rol actual + trayectoria en planta.</p>

                <div class="divider"></div>

                <div class="cards" id="experience-cards">
                  <article class="item">
                    <h4>Supervisor ‚Äì Postob√≥n S.A. <span class="badge">Actual</span></h4>
                    <p class="muted">Cali, Colombia</p>
                    <ul class="detail-list">
                      <li>Supervisi√≥n de operaciones en planta, est√°ndares de calidad, productividad y seguridad.</li>
                      <li>Asignaci√≥n y seguimiento de tareas para continuidad de producci√≥n.</li>
                      <li>Reportes e indicadores con herramientas ofim√°ticas y sistemas internos.</li>
                      <li>Trabajo con Mantenimiento para reportar incidentes y proponer mejoras.</li>
                    </ul>
                  </article>

                  <article class="item">
                    <h4>T√©cnico ‚Äì Postob√≥n S.A.</h4>
                    <p class="muted">Cali, Colombia</p>
                    <ul class="detail-list">
                      <li>Soporte t√©cnico en l√≠neas de producci√≥n y equipos.</li>
                      <li>Registro de incidencias/intervenciones mejorando trazabilidad.</li>
                      <li>Colaboraci√≥n para reducir tiempos de parada y aumentar eficiencia.</li>
                    </ul>
                  </article>
                </div>
              </section>

              <!-- PROJECTS -->
              <section class="page" id="projects" data-page>
                <h2 class="section-title">Proyectos</h2>
                <p class="muted">Proyectos con impacto (operaci√≥n real + innovaci√≥n).</p>

                <div class="divider"></div>

                <div class="cards" id="projects-cards">
                  <article class="item">
                    <h4>Aplicativo low-code nacional ‚Äì Postob√≥n S.A.</h4>
                    <p class="muted">
                      Control de personal y tareas de Mantenimiento ¬∑
                      <span class="badge">~1300 usuarios</span>
                    </p>
                    <ul class="detail-list">
                      <li>Dise√±o e implementaci√≥n para control de personal, asignaci√≥n y seguimiento.</li>
                      <li>Centralizaci√≥n de procesos manuales en flujo digital trazable.</li>
                    </ul>
                  </article>

                  <article class="item">
                    <h4>Rally Latinoamericano de Innovaci√≥n ‚Äì 1er lugar</h4>
                    <p class="muted">Categor√≠a Innovaci√≥n (UAO)</p>
                    <ul class="detail-list">
                      <li>Integrante del equipo ganador con soluci√≥n a reto real en tiempo limitado.</li>
                    </ul>
                  </article>

                  <article class="item">
                    <h4>Platzi Space Program ‚Äì Sat√©lite</h4>
                    <p class="muted">Programa intensivo</p>
                    <ul class="detail-list">
                      <li>Refuerzo de fundamentos de ingenier√≠a, trabajo en equipo y pensamiento sist√©mico.</li>
                    </ul>
                  </article>
                </div>
              </section>

              <!-- EDUCATION -->
              <section class="page" id="education" data-page>
                <h2 class="section-title">Educaci√≥n</h2>
                <p class="muted">Formaci√≥n base + especializaci√≥n en datos/IA.</p>

                <div class="divider"></div>

                <div class="cards" id="education-cards">
                  <article class="item">
                    <h4>Ingenier√≠a en Datos e Inteligencia Artificial</h4>
                    <p class="muted">Universidad Aut√≥noma de Occidente (UAO) ¬∑ Cali, Colombia</p>
                    <p class="muted" style="margin-top: 8px">
                      Etapa final ¬∑ Incluye certificaci√≥n de ingl√©s (B1/B2).
                    </p>
                  </article>

                  <article class="item">
                    <h4>Tecnolog√≠a en Gesti√≥n de Sistemas Mecatr√≥nicos</h4>
                    <p class="muted">FCECEP ¬∑ Cali, Colombia</p>
                  </article>
                </div>
              </section>

              <!-- CERTS -->
              <section class="page" id="certs" data-page>
                <h2 class="section-title">Certificaciones</h2>
                <p class="muted">Cursos, certificaciones y formaci√≥n adicional.</p>

                <div class="divider"></div>

                <div class="grid-2">
                  <div class="item">
                    <h4>Certificaciones (LinkedIn)</h4>

                    <div id="certifications" style="margin-top: 10px"></div>

                    <p class="muted" id="certs-empty" style="display: none; margin-top: 10px">
                      No hay certificaciones para mostrar.
                    </p>
                  </div>

                  <div class="item">
                    <h4>Formaci√≥n adicional</h4>
                    <p class="muted">
                      M√°s de 18 cursos completados como parte de una ruta integral en An√°lisis de Datos y Business
                      Intelligence, incluyendo Power BI, DAX, Tableau, Looker Studio, Excel avanzado, forecasting,
                      m√©tricas de negocio, storytelling, estad√≠stica aplicada.
                      Adem√°s de cursos de fundamentos de Python, circuitos electr√≥nicos, electricidad e ingl√©s t√©cnico
                      enfocado en tecnolog√≠a e innovaci√≥n.
                    </p>

                    <div class="divider"></div>

                    <button class="mini-btn mini-btn--yellow" type="button" id="open-cv-from-certs" popovertarget="cv"
                      popovertargetaction="show">
                      Abrir CV / Imprimir
                    </button>
                  </div>
                </div>
              </section>

              <!-- CONTACT -->
              <section class="page" id="contact" data-page>
                <h2 class="section-title">Contacto</h2>
                <p class="muted">
                  Email: <span id="email-text">cesar.cesarreyes25@gmail.com</span>
                </p>

                <div class="divider"></div>

                <div class="item">
                  <h4>Mensaje r√°pido</h4>
                  <p class="muted">‚ÄúHola C√©sar, vi tu perfil y me gustar√≠a hablar sobre‚Ä¶‚Äù</p>
                </div>

                <div class="divider"></div>

                <p class="muted" style="text-align: center; opacity: 0.9">
                  ¬© <span id="year"></span> C√©sar Reyes
                </p>
              </section>

              <!-- INSTAGRAM -->
              <section class="page" id="instagram" data-page>
                <h2 class="section-title">Instagram</h2>
                <p class="muted">Previsualizaci√≥n + acceso r√°pido.</p>

                <div class="divider"></div>

                <div class="embed-grid">
                  <div class="embed-wrap">
                    <h3 class="embed-title">Perfil</h3>
                    <p class="embed-note">
                      Si tu navegador bloquea el embed (a veces pasa por pol√≠ticas de terceros), usa el bot√≥n
                      ‚ÄúAbrir en Instagram‚Äù.
                    </p>

                    <div class="ratio">
                      <div id="ig-embed-slot">
                        <!-- Instagram embed (se inyecta por JS) -->
                      </div>
                    </div>

                    <div class="divider"></div>

                    <div class="cert-actions">
                      <button class="mini-btn" type="button" id="open-instagram">
                        Abrir en Instagram
                      </button>
                      <button class="mini-btn" type="button" id="copy-instagram">
                        Copiar link
                      </button>
                    </div>
                  </div>

                  <div class="embed-wrap">
                    <h3 class="embed-title">Atajo</h3>
                    <p class="embed-note">
                      Puedes usar <code>U</code> (Actions) para abrir Instagram desde cualquier secci√≥n.
                    </p>

                    <div class="item">
                      <h4>Link</h4>
                      <p class="muted" id="ig-link-text">‚Äî</p>
                    </div>

                    <div class="divider"></div>

                    <div class="item">
                      <h4>Preview mini</h4>
                      <p class="muted" style="margin-bottom: 10px">
                        (Mismo embed, compacto)
                      </p>
                      <div class="ratio mini-ratio">
                        <div id="ig-embed-mini"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </section>

              <!-- SPOTIFY -->
              <section class="page" id="spotify" data-page>
                <h2 class="section-title">Spotify</h2>
                <p class="muted">Previsualizaci√≥n + acceso r√°pido.</p>

                <div class="divider"></div>

                <div class="embed-grid">
                  <div class="embed-wrap">
                    <h3 class="embed-title">Perfil (embed)</h3>
                    <p class="embed-note">
                      Si Spotify no permite embed de perfil en tu regi√≥n/navegador, el bot√≥n ‚ÄúAbrir en Spotify‚Äù
                      siempre funciona.
                    </p>

                    <div class="ratio">
                      <iframe class="embed-frame" id="sp-embed" title="Spotify embed" loading="lazy"
                        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
                    </div>

                    <div class="divider"></div>

                    <div class="cert-actions">
                      <button class="mini-btn" type="button" id="open-spotify">
                        Abrir en Spotify
                      </button>
                      <button class="mini-btn" type="button" id="copy-spotify">
                        Copiar link
                      </button>
                    </div>
                  </div>

                  <div class="embed-wrap">
                    <h3 class="embed-title">Atajo</h3>
                    <p class="embed-note">
                      Puedes usar <code>U</code> (Actions) para abrir Spotify desde cualquier secci√≥n.
                    </p>

                    <div class="item">
                      <h4>Link</h4>
                      <p class="muted" id="sp-link-text">‚Äî</p>
                    </div>

                    <div class="divider"></div>

                    <div class="item">
                      <h4>Recomendaci√≥n (si quieres un embed 100% seguro)</h4>
                      <p class="muted" style="margin-top: 8px">
                        Spotify embebe perfecto playlists/√°lbumes/canciones. Si me pasas una playlist tuya,
                        la pongo aqu√≠ con 0 fallos.
                      </p>
                    </div>
                  </div>
                </div>
              </section>
            </div>
          </div>
        </div>
      </main>

      <!-- Right rail -->
      <aside>
        <div class="pad">
          <div class="pad__body pad__scroll">
            <h2 class="section-title">Snapshot</h2>
            <p class="muted" id="snapshot">Vista r√°pida. Se actualiza seg√∫n la secci√≥n.</p>

            <div class="divider"></div>

            <div class="item">
              <h4>Secci√≥n actual</h4>
              <p class="muted" id="current-section">Sobre m√≠</p>
            </div>

            <div class="divider"></div>

            <button class="item" id="cv-card" type="button" popovertarget="cv" popovertargetaction="show"
              style="width: 100%; text-align: left; cursor: pointer" aria-label="Abrir CV">
              <h4>CV / Imprimir</h4>
              <p class="muted">Genera tu hoja de vida con los datos actuales del sitio.</p>
              <div class="divider"></div>
              <p class="muted">
                <span class="mono" style="color: var(--colors-tertiary--500)">Atajo</span>
                <span style="opacity: 0.8">:</span>
                <span class="mono">C</span>
              </p>
            </button>

            <div class="divider"></div>

            <!-- MEMENTO MORI WIDGET -->
            <button class="item" id="mm-card" type="button" popovertarget="memento" popovertargetaction="show"
              style="width: 100%; text-align: left; cursor: pointer" aria-label="Abrir Memento Mori">
              <div class="mm-header">
                <h3 class="mm-title">Memento Mori</h3>
                <span class="badge">Semanas</span>
              </div>
              <p class="mm-sub" id="mm-sub">Cargando‚Ä¶</p>

              <div class="mm-stats">
                <div class="mm-stat">
                  <b>Vividas</b>
                  <span id="mm-lived">‚Äî</span>
                </div>
                <div class="mm-stat">
                  <b>Restantes</b>
                  <span id="mm-left">‚Äî</span>
                </div>
              </div>

              <div class="mm-canvas-wrap">
                <canvas id="mm-canvas" width="280" height="220" aria-label="Calendario de vida por semanas"></canvas>
                <div class="mm-legend">
                  <span><i class="dot dot--lived"></i>vividas</span>
                  <span><i class="dot dot--left"></i>restantes</span>
                  <span><i class="dot dot--now"></i>semana actual</span>
                </div>
              </div>
            </button>

            <div class="divider"></div>

            <p class="muted" style="margin: 0">
              <span class="mono" style="color: var(--colors-tertiary--500)">NETWIRE_ID</span>
              <span style="opacity: 0.8">:</span>
              <span id="seed" class="muted"></span>
            </p>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <!-- Popover: Quick Actions -->
  <div class="modal" popover="auto" id="actions">
    <section class="modal__body">
      <div class="body__content">
        <h2><span>Quick Actions</span></h2>
        <p>Links y utilidades.</p>

        <div class="divider"></div>

        <div class="modal__actions">
          <button class="action-btn" data-action="linkedin" type="button">Open LinkedIn</button>
          <button class="action-btn" data-action="github" type="button">Open GitHub</button>
          <button class="action-btn" data-action="instagram" type="button">Open Instagram</button>
          <button class="action-btn" data-action="spotify" type="button">Open Spotify</button>
          <button class="action-btn" data-action="cv" type="button">Open CV / Print</button>
          <button class="action-btn" data-action="copy" type="button">Copy email</button>
          <button class="action-btn action-btn--danger" data-action="close" type="button">Close (Esc)</button>
        </div>
      </div>
    </section>
  </div>

  <!-- Popover: Memento Mori -->
  <div class="modal" popover="auto" id="memento">
    <section class="modal__body">
      <div class="body__content">
        <h2><span>Memento Mori</span></h2>
        <p id="mm-modal-sub">Tiempo restante en semana / d√≠a / vida (estimado).</p>

        <div class="divider"></div>

        <div class="mm-kv">
          <div class="item">
            <h4>Fin del d√≠a</h4>
            <p class="muted mono" id="t-day">‚Äî</p>
          </div>
          <div class="item">
            <h4>Fin de la semana</h4>
            <p class="muted mono" id="t-week">‚Äî</p>
          </div>
          <div class="item">
            <h4>Vida (estimado)</h4>
            <p class="muted mono" id="t-life">‚Äî</p>
            <p class="muted" id="life-date" style="margin-top: 8px; opacity: 0.9"></p>
          </div>
          <div class="item">
            <h4>Semanas</h4>
            <p class="muted">
              <span class="mono">Vividas:</span> <span id="mm-lived-2">‚Äî</span><br />
              <span class="mono">Restantes:</span> <span id="mm-left-2">‚Äî</span><br />
              <span class="mono">Total:</span> <span id="mm-total-2">‚Äî</span>
            </p>
          </div>
        </div>

        <div class="modal__actions">
          <button class="action-btn action-btn--danger" data-action="close-mm" type="button">Close (Esc)</button>
        </div>
      </div>
    </section>
  </div>

  <!-- Popover: CV -->
  <div class="modal modal--wide" popover="auto" id="cv">
    <section class="modal__body">
      <div class="body__content">
        <h2><span>Hoja de Vida</span></h2>
        <p>Previsualizaci√≥n (basada en los datos actuales del sitio). Lista para imprimir.</p>

        <div class="divider"></div>

        <div class="cv-frame">
          <iframe id="cv-iframe" title="Previsualizaci√≥n CV"></iframe>
        </div>

        <div class="modal__actions">
          <button class="action-btn" id="cv-print" type="button">Print</button>
          <button class="action-btn" id="cv-open-new" type="button">Open in new tab</button>
          <button class="action-btn action-btn--danger" data-action="close-cv" type="button">Close (Esc)</button>
        </div>
      </div>
    </section>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <!-- Instagram embed script (se carga 1 vez) -->
  <script async src="https://www.instagram.com/embed.js"></script>

  <script>
    const $ = (sel, root = document) => root.querySelector(sel);
    const $$ = (sel, root = document) => Array.from(root.querySelectorAll(sel));

    const toastEl = $("#toast");
    function toast(msg) {
      toastEl.textContent = msg;
      toastEl.classList.add("is-on");
      window.clearTimeout(toastEl._t);
      toastEl._t = window.setTimeout(() => toastEl.classList.remove("is-on"), 1400);
    }

    function seed() {
      const s = crypto?.getRandomValues ? crypto.getRandomValues(new Uint8Array(16)) : null;
      if (!s) return "d869db7f-e62f-b07c-25a0-403e-caea5503";
      return Array.from(s)
        .map((b) => b.toString(16).padStart(2, "0"))
        .join("");
    }
    $("#seed").textContent = seed();
    $("#year").textContent = new Date().getFullYear();

    let LINKS = {
      linkedin: "https://www.linkedin.com",
      github: "https://github.com/caesar-dat-com",
      instagram: "https://www.instagram.com/caesar__palace/?__pwa=1",
      spotify: "https://open.spotify.com/user/31hu2kdccm2vguqtnndm5ecgc2jy?si=fdb28cbfe7b0495b",
    };

    const EMAIL = "cesar.cesarreyes25@gmail.com";

    // DANE (hombres) ~ 74,48 a√±os. (usado como estimaci√≥n para el Memento Mori)
    const LIFE_EXPECTANCY_YEARS_CO_MALE = 74.48;

    const BIRTH = new Date(2000, 0, 25, 0, 0, 0, 0); // 25 Jan 2000

    // ===== LinkedIn JSON fallback =====
    const defaultSummary =
      "Enfocado en automatizaci√≥n, datos e IA, construyo sistemas √∫tiles, medibles y trazables en entornos reales.";

    const fallback = {
      firstName: "C√©sar",
      lastName: "Reyes",
      headline: "Data ¬∑ IA ¬∑ Automatizaci√≥n",
      location: "Colombia",
      publicProfileUrl: LINKS.linkedin,
      summary: defaultSummary,
      skills: [
        { name: "Python" },
        { name: "Power BI" },
        { name: "DAX" },
        { name: "Excel" },
        { name: "Git" },
        { name: "HTML/CSS" },
      ],
      certifications: [],
    };

    let allSkills = [];
    let allCerts = [];
    let loadedProfile = null;

    async function loadLinkedIn() {
      try {
        const res = await fetch("linkedin-data.json", { cache: "no-store" });
        if (!res.ok) throw new Error("No se pudo cargar linkedin-data.json");
        const data = await res.json();
        return { ...fallback, ...data };
      } catch (e) {
        console.warn("LinkedIn JSON fallback:", e);
        return fallback;
      }
    }

    function renderSkills(list, query = "") {
      const ul = $("#skills");
      const empty = $("#skills-empty");
      if (!ul) return;
      ul.innerHTML = "";

      const q = query.trim().toLowerCase();
      const filtered = !q ? list : list.filter((s) => (s?.name || "").toLowerCase().includes(q));

      if (!filtered.length) {
        empty.style.display = "block";
        return;
      }
      empty.style.display = "none";

      filtered.slice(0, 90).forEach((skill) => {
        const li = document.createElement("li");
        li.className = "chip";
        li.textContent = skill.name;
        ul.appendChild(li);
      });
    }

    // Si LinkedIn no te da URL exacta del certificado, puedes forzar aqu√≠ links por nombre.
    // Ejemplo:
    // CERT_LINK_OVERRIDES["Google Data Analytics"] = "https://www.linkedin.com/.../certificate/...."
    const CERT_LINK_OVERRIDES = {};

    function getCertLink(cert) {
      const name = (cert?.name || "").trim();
      if (name && CERT_LINK_OVERRIDES[name]) return CERT_LINK_OVERRIDES[name];

      // Variantes comunes en exports:
      const possible =
        cert?.url ||
        cert?.certUrl ||
        cert?.certificateUrl ||
        cert?.externalUrl ||
        cert?.link ||
        cert?.verificationUrl ||
        cert?.licenseUrl ||
        cert?.publicUrl;

      if (possible) return possible;

      // Fallback: tu perfil de LinkedIn (no es ideal, pero no inventa URLs).
      return LINKS.linkedin;
    }

    function renderCerts(list, query = "") {
      const wrap = $("#certifications");
      const empty = $("#certs-empty");
      if (!wrap) return;
      wrap.innerHTML = "";

      const q = query.trim().toLowerCase();
      const filtered = !q
        ? list
        : list.filter((c) => {
          const n = (c?.name || "").toLowerCase();
          const a = (c?.authority || "").toLowerCase();
          return n.includes(q) || a.includes(q);
        });

      if (!filtered.length) {
        empty.style.display = "block";
        return;
      }
      empty.style.display = "none";

      filtered.slice(0, 120).forEach((cert) => {
        const startDate = cert.timePeriod?.startDate
          ? `${cert.timePeriod.startDate.month}/${cert.timePeriod.startDate.year}`
          : "N/A";
        const endDate = cert.timePeriod?.endDate
          ? `${cert.timePeriod.endDate.month}/${cert.timePeriod.endDate.year}`
          : "En curso";

        const name = cert.name || "Certificaci√≥n";
        const authority = cert.authority || "N/A";
        const link = getCertLink(cert);

        const row = document.createElement("div");
        row.className = "cert-row";

        row.innerHTML = `
            <div class="cert-meta">
              <strong>${escapeHtml(name)}</strong><br/>
              <span style="opacity:.92;">Autoridad: ${escapeHtml(authority)}</span><br/>
              <span style="opacity:.92;">Inicio: ${escapeHtml(startDate)} ¬∑ Fin: ${escapeHtml(endDate)}</span>
            </div>
            <div class="cert-actions">
              <button class="mini-btn" type="button" data-cert-open="${encodeAttr(link)}">Ver en LinkedIn</button>
              <button class="mini-btn mini-btn--yellow" type="button" data-cert-copy="${encodeAttr(link)}">Copiar link</button>
            </div>
          `;

        wrap.appendChild(row);
      });

      // Delegaci√≥n para botones
      wrap.addEventListener(
        "click",
        async (e) => {
          const openBtn = e.target.closest("button[data-cert-open]");
          const copyBtn = e.target.closest("button[data-cert-copy]");
          if (openBtn) {
            const url = openBtn.getAttribute("data-cert-open");
            if (url) window.open(url, "_blank", "noreferrer");
          }
          if (copyBtn) {
            const url = copyBtn.getAttribute("data-cert-copy");
            if (!url) return;
            try {
              await navigator.clipboard.writeText(url);
              toast("LINK COPIADO");
            } catch {
              toast("NO SE PUDO COPIAR");
            }
          }
        },
        { once: true }
      );
    }

    function escapeHtml(str) {
      return String(str ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }
    function encodeAttr(str) {
      return escapeHtml(str).replaceAll("\n", " ");
    }

    // ===== Router (solo una secci√≥n visible) =====
    const stage = $("#stage");
    const pages = $$("[data-page]");
    const railButtons = $$("#rail button");

    const sectionMeta = {
      about: "Qui√©n soy y enfoque actual.",
      stack: "Skills y herramientas. El filtro aplica aqu√≠.",
      experience: "Rol actual y trayectoria en planta.",
      projects: "Construcci√≥n de soluciones √∫tiles y medibles.",
      education: "Formaci√≥n base + especializaci√≥n.",
      certs: "Certificaciones y cursos (con links).",
      contact: "Contacto r√°pido v√≠a Actions (U).",
      instagram: "Previsualizaci√≥n del perfil + link.",
      spotify: "Previsualizaci√≥n + link.",
    };

    function setRailActive(id) {
      railButtons.forEach((b) => b.classList.toggle("is-active", b.dataset.go === id));
    }

    function setSnapshot(id) {
      const names = {
        about: "Sobre m√≠",
        stack: "Stack",
        experience: "Experiencia",
        projects: "Proyectos",
        education: "Educaci√≥n",
        certs: "Certificaciones",
        contact: "Contacto",
        instagram: "Instagram",
        spotify: "Spotify",
      };
      $("#current-section").textContent = names[id] || "‚Äî";
      $("#snapshot").textContent = sectionMeta[id] || "Vista r√°pida.";
    }

    function showGlitchPulse() {
      stage.classList.add("is-glitch");
      window.clearTimeout(stage._g);
      stage._g = window.setTimeout(() => stage.classList.remove("is-glitch"), 460);
    }

    function navigate(id, { pushHash = true } = {}) {
      const target = document.getElementById(id);
      if (!target) return;

      const current = pages.find((p) => p.classList.contains("is-active"));
      if (current && current.id === id) return;

      const run = () => {
        if (current) current.classList.remove("is-active");
        target.classList.add("is-active");
        setRailActive(id);
        setSnapshot(id);
        stage.scrollTop = 0;
      };

      showGlitchPulse();
      if (document.startViewTransition) document.startViewTransition(run);
      else run();

      if (pushHash) history.replaceState(null, "", `#${id}`);
    }

    railButtons.forEach((b) => b.addEventListener("click", () => navigate(b.dataset.go)));

    // ===== Actions popover =====
    const popActions = $("#actions");
    $("#actions").addEventListener("click", async (e) => {
      const btn = e.target.closest("button[data-action]");
      if (!btn) return;
      const act = btn.dataset.action;

      if (act === "linkedin") window.open(LINKS.linkedin, "_blank", "noreferrer");
      if (act === "github") window.open(LINKS.github, "_blank", "noreferrer");
      if (act === "instagram") window.open(LINKS.instagram, "_blank", "noreferrer");
      if (act === "spotify") window.open(LINKS.spotify, "_blank", "noreferrer");
      if (act === "cv") {
        const pop = $("#cv");
        pop.showPopover();
        hydrateCvPreview(); // siempre actualizado
      }

      if (act === "copy") {
        try {
          await navigator.clipboard.writeText(EMAIL);
          toast("EMAIL COPIADO");
        } catch {
          toast("NO SE PUDO COPIAR");
        }
      }

      if (act === "close") popActions.hidePopover();
    });

    // ===== Memento Mori =====
    const popMemento = $("#memento");
    $("#memento").addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-action]");
      if (!btn) return;
      if (btn.dataset.action === "close-mm") popMemento.hidePopover();
    });

    function msToParts(ms) {
      const s = Math.max(0, Math.floor(ms / 1000));
      const days = Math.floor(s / 86400);
      const hours = Math.floor((s % 86400) / 3600);
      const mins = Math.floor((s % 3600) / 60);
      const secs = s % 60;
      return { days, hours, mins, secs };
    }

    function fmtDHMS({ days, hours, mins, secs }) {
      const hh = String(hours).padStart(2, "0");
      const mm = String(mins).padStart(2, "0");
      const ss = String(secs).padStart(2, "0");
      return days > 0 ? `${days}d ${hh}:${mm}:${ss}` : `${hh}:${mm}:${ss}`;
    }

    function endOfDay(now) {
      const d = new Date(now);
      d.setHours(23, 59, 59, 999);
      return d;
    }

    // Semana: termina Domingo 23:59:59 local
    function endOfWeek(now) {
      const d = new Date(now);
      const day = d.getDay(); // 0=Dom
      const daysToSunday = (7 - 1 - day + 7) % 7; // si hoy es domingo -> 0
      const eod = endOfDay(d);
      eod.setDate(eod.getDate() + daysToSunday);
      return eod;
    }

    function lifeEndDate() {
      const days = LIFE_EXPECTANCY_YEARS_CO_MALE * 365.2425;
      return new Date(BIRTH.getTime() + days * 86400000);
    }

    function weeksTotals() {
      const totalDays = LIFE_EXPECTANCY_YEARS_CO_MALE * 365.2425;
      const totalWeeks = Math.round(totalDays / 7);
      return totalWeeks;
    }

    function calcWeeks(now) {
      const totalWeeks = weeksTotals();
      const livedWeeks = Math.max(0, Math.floor((now - BIRTH) / 604800000));
      const leftWeeks = Math.max(0, totalWeeks - livedWeeks);
      const currentWeekIndex = Math.min(totalWeeks - 1, livedWeeks); // semana actual
      return { totalWeeks, livedWeeks, leftWeeks, currentWeekIndex };
    }

    function drawMementoGrid(now) {
      const c = $("#mm-canvas");
      if (!c) return;

      const ctx = c.getContext("2d");
      const dpr = Math.max(1, window.devicePixelRatio || 1);

      const cssW = c.clientWidth || c.width;
      const cssH = c.clientHeight || c.height;

      c.width = Math.floor(cssW * dpr);
      c.height = Math.floor(cssH * dpr);
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

      const { totalWeeks, livedWeeks, currentWeekIndex } = calcWeeks(now);

      const cols = 52;
      const rows = Math.ceil(totalWeeks / cols);

      const pad = 6;
      const w = cssW - pad * 2;
      const h = cssH - pad * 2;

      const gap = 1;
      const cellW = Math.floor((w - gap * (cols - 1)) / cols);
      const cellH = Math.floor((h - gap * (rows - 1)) / rows);
      const cell = Math.max(1, Math.min(cellW, cellH));

      const gridW = cols * cell + gap * (cols - 1);
      const gridH = rows * cell + gap * (rows - 1);

      const ox = Math.floor((cssW - gridW) / 2);
      const oy = Math.floor((cssH - gridH) / 2);

      const styles = getComputedStyle(document.documentElement);
      const livedColor = styles.getPropertyValue("--accent").trim() || "#2be4ea";
      const leftColor = "rgba(255,255,255,0.12)";
      const nowColor = styles.getPropertyValue("--colors-tertiary--500").trim() || "#fed33f";

      ctx.clearRect(0, 0, cssW, cssH);

      for (let i = 0; i < totalWeeks; i++) {
        const r = Math.floor(i / cols);
        const col = i % cols;
        const x = ox + col * (cell + gap);
        const y = oy + r * (cell + gap);

        const isLived = i < livedWeeks;
        const isNow = i === currentWeekIndex;

        ctx.fillStyle = isNow ? nowColor : isLived ? livedColor : leftColor;
        ctx.fillRect(x, y, cell, cell);
      }
    }

    function updateMemento(now = new Date()) {
      const { totalWeeks, livedWeeks, leftWeeks } = calcWeeks(now);

      $("#mm-sub").textContent = `Nacido: 25/01/2000 ¬∑ Total: ${totalWeeks} semanas`;
      $("#mm-lived").textContent = `${livedWeeks}`;
      $("#mm-left").textContent = `${leftWeeks}`;

      $("#mm-lived-2").textContent = `${livedWeeks}`;
      $("#mm-left-2").textContent = `${leftWeeks}`;
      $("#mm-total-2").textContent = `${totalWeeks}`;

      drawMementoGrid(now);

      const eod = endOfDay(now);
      const eow = endOfWeek(now);
      const eol = lifeEndDate();

      $("#t-day").textContent = fmtDHMS(msToParts(eod - now));
      $("#t-week").textContent = fmtDHMS(msToParts(eow - now));

      const lifeMs = eol - now;
      const lifeParts = msToParts(lifeMs);
      $("#t-life").textContent =
        lifeMs <= 0
          ? "00:00:00"
          : `${lifeParts.days}d ${String(lifeParts.hours).padStart(2, "0")}:${String(lifeParts.mins).padStart(2, "0")}:${String(lifeParts.secs).padStart(2, "0")}`;

      $("#life-date").textContent = `Fecha estimada: ${eol.toLocaleString("es-CO", {
        year: "numeric",
        month: "long",
        day: "numeric",
      })} ¬∑ (Usando ${LIFE_EXPECTANCY_YEARS_CO_MALE} a√±os)`;
    }

    // Search filter
    $("#search").addEventListener("input", (e) => {
      const q = e.target.value || "";
      renderSkills(allSkills, q);
      renderCerts(allCerts, q);
    });

    // Instagram + Spotify helpers
    function normalizeInstagramEmbedUrl(url) {
      // Instagram permite /embed para perfil
      // Si el /embed falla por pol√≠ticas del navegador, igual dejamos fallback al link.
      const u = new URL(url);
      const path = u.pathname.replace(/\/+$/, "");
      // /caesar__palace
      return `https://www.instagram.com${path}/embed`;
    }

    function buildInstagramBlockquote(permalink) {
      // Embed oficial via script instagram embed.js (tiende a verse mejor y sin barras raras)
      // Si IG lo bloquea, el fallback link igual queda.
      const safe = permalink.split("?")[0];
      return `
          <blockquote class="instagram-media"
            data-instgrm-permalink="${safe}"
            data-instgrm-version="14"
            style="background:rgba(0,0,0,0.12); border:1px solid rgba(43,228,234,0.25); margin:0; max-width:100%; width:100%;">
          </blockquote>
        `;
    }

    function ensureInstagramEmbed() {
      const slot = $("#ig-embed-slot");
      const mini = $("#ig-embed-mini");
      if (!slot || !mini) return;

      // Opci√≥n A: embed script (mejor aspecto)
      slot.innerHTML = buildInstagramBlockquote(LINKS.instagram);
      mini.innerHTML = buildInstagramBlockquote(LINKS.instagram);

      // Forzar re-proceso del embed si el script ya carg√≥
      window.setTimeout(() => {
        if (window.instgrm?.Embeds?.process) {
          try {
            window.instgrm.Embeds.process();
          } catch { }
        } else {
          // Opci√≥n B: fallback a iframe /embed si script no est√° disponible
          const iframeA = document.createElement("iframe");
          iframeA.className = "embed-frame";
          iframeA.loading = "lazy";
          iframeA.allow = "clipboard-write; encrypted-media; fullscreen";
          iframeA.referrerPolicy = "no-referrer-when-downgrade";
          iframeA.src = normalizeInstagramEmbedUrl(LINKS.instagram);
          slot.innerHTML = "";
          slot.appendChild(iframeA);

          const iframeB = iframeA.cloneNode();
          iframeB.src = normalizeInstagramEmbedUrl(LINKS.instagram);
          mini.innerHTML = "";
          mini.appendChild(iframeB);
        }
      }, 350);
    }

    function setSpotifyEmbed() {
      const iframe = $("#sp-embed");
      if (!iframe) return;

      // Intento 1: embed de user (puede fallar seg√∫n Spotify)
      const userId = "31hu2kdccm2vguqtnndm5ecgc2jy";
      const attempt1 = `https://open.spotify.com/embed/user/${userId}`;

      // Intento 2: embed de perfil via open url (a veces resuelve)
      const attempt2 = `https://open.spotify.com/embed?uri=spotify:user:${userId}`;

      // Ponemos intento 1; si no carga en 2s, cambiamos al intento 2.
      iframe.src = attempt1;
      window.setTimeout(() => {
        try {
          // Si por alguna raz√≥n qued√≥ en blanco, cambiamos (no podemos inspeccionar cross-origin; esto es best-effort)
          if (!iframe.src) iframe.src = attempt2;
        } catch {
          iframe.src = attempt2;
        }
      }, 2000);
    }

    // CV generation (preview + print)
    function collectDomListItems(rootSelector) {
      const root = document.querySelector(rootSelector);
      if (!root) return [];
      const items = Array.from(root.querySelectorAll("article.item"));
      return items.map((card) => {
        const title = (card.querySelector("h4")?.textContent || "").trim();
        const subtitle = (card.querySelector("p.muted")?.textContent || "").trim();
        const bullets = Array.from(card.querySelectorAll("ul.detail-list li")).map((li) => li.textContent.trim());
        return { title, subtitle, bullets };
      });
    }

    function getCoreSkillsFromDom() {
      return Array.from(document.querySelectorAll("#core-skills .chip")).map((x) => x.textContent.trim());
    }

    function buildCvHtml(data) {
      const fullName = `${data.firstName || "C√©sar"} ${data.lastName || "Reyes"}`.trim();
      const headline = (data.headline || "Data ¬∑ IA ¬∑ Automatizaci√≥n").trim();
      const location = (data.location || "Colombia").trim();
      const summary = (data.summary || defaultSummary).trim();

      const skillsLinkedIn = (data.skills || []).map((s) => s?.name).filter(Boolean);
      const skillsCore = getCoreSkillsFromDom();
      const skillsMerged = Array.from(new Set([...skillsCore, ...skillsLinkedIn])).slice(0, 26);

      const exp = collectDomListItems("#experience-cards");
      const proj = collectDomListItems("#projects-cards");

      const eduCards = collectDomListItems("#education-cards");
      const education = eduCards.map((e) => ({
        title: e.title,
        subtitle: e.subtitle,
        note: (e.bullets || []).join(" ¬∑ "),
      }));

      const certs = (data.certifications || []).slice(0, 40).map((c) => {
        const name = c?.name || "Certificaci√≥n";
        const authority = c?.authority || "N/A";
        const link = getCertLink(c);
        const startDate = c.timePeriod?.startDate
          ? `${c.timePeriod.startDate.month}/${c.timePeriod.startDate.year}`
          : "N/A";
        const endDate = c.timePeriod?.endDate
          ? `${c.timePeriod.endDate.month}/${c.timePeriod.endDate.year}`
          : "En curso";
        return { name, authority, link, startDate, endDate };
      });

      const linkedinPretty = data.publicProfileUrl || LINKS.linkedin;

      // Template basado en tu CV (layout limpio para impresi√≥n)
      return `<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Hoja de Vida - ${escapeHtml(fullName)}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --accent: #2563eb;
      --accent-soft: #dbeafe;
      --bg: #f3f4f6;
      --text-main: #111827;
      --text-muted: #4b5563;
      --card-bg: #ffffff;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { max-width: 100%; overflow-x: hidden; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg);
      color: var(--text-main);
      padding: 24px;
      display: flex;
      justify-content: center;
    }
    .page {
      width: 100%;
      max-width: 900px;
      background: var(--card-bg);
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.15);
      border-radius: 18px;
      overflow: hidden;
      display: grid;
      grid-template-columns: minmax(0, 3fr) minmax(0, 5fr);
      min-height: 100%;
    }
    .left {
      background: linear-gradient(160deg, #1d4ed8, #0ea5e9);
      color: #e5f0ff;
      padding: 28px 26px 32px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      min-width: 0;
    }
    .right {
      padding: 28px 32px 32px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      min-width: 0;
    }
    .name {
      font-size: 26px;
      font-weight: 800;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      overflow-wrap: anywhere;
    }
    .role-line {
      margin-top: 6px;
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.18em;
      opacity: 0.95;
      overflow-wrap: anywhere;
    }
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.18);
      font-size: 11px;
      margin-top: 10px;
    }
    .chip-dot { width: 7px; height: 7px; border-radius: 999px; background: #22c55e; }
    .section-title {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.22em;
      text-transform: uppercase;
      color: #cbd5f5;
      margin-bottom: 6px;
    }
    .section-title.dark { color: var(--text-muted); }
    .left p { font-size: 12px; line-height: 1.55; }
    .contact-item {
      display: flex; align-items: center; gap: 8px;
      font-size: 11px; line-height: 1.4; opacity: 0.98;
      word-break: break-word;
    }
    .contact-icon {
      width: 18px; height: 18px;
      border-radius: 999px;
      border: 1px solid rgba(219, 234, 254, 0.7);
      display: flex; align-items: center; justify-content: center;
      font-size: 10px; flex: 0 0 auto;
    }
    .pill-list { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 6px; }
    .pill {
      font-size: 11px;
      padding: 5px 8px;
      border-radius: 999px;
      border: 1px solid rgba(219, 234, 254, 0.7);
      background: rgba(15, 23, 42, 0.18);
      white-space: nowrap;
      max-width: 100%;
    }
    .summary { font-size: 12px; line-height: 1.6; color: var(--text-main); overflow-wrap: anywhere; }
    .block { display: flex; flex-direction: column; gap: 8px; }
    .item-header { display: flex; justify-content: space-between; gap: 8px; align-items: baseline; }
    .item-title { font-weight: 700; font-size: 12px; color: var(--text-main); overflow-wrap: anywhere; }
    .item-subtitle { font-size: 11px; color: var(--text-muted); overflow-wrap: anywhere; }
    .item-tag { font-size: 10px; color: var(--accent); font-weight: 700; letter-spacing: 0.12em; text-transform: uppercase; }
    .bullet-list { margin-top: 4px; display: flex; flex-direction: column; gap: 3px; }
    .bullet {
      font-size: 11px; line-height: 1.5; color: var(--text-muted);
      position: relative; padding-left: 12px;
      overflow-wrap: anywhere;
    }
    .bullet::before { content: "‚Ä¢"; position: absolute; left: 0; top: 0; color: var(--accent); }
    .inline-badge {
      display: inline-block;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: var(--accent);
      font-weight: 700;
      margin-left: 4px;
    }
    .kv { font-size: 11px; line-height: 1.45; color: rgba(229, 240, 255, 0.95); }
    .link {
      color: #ffffff;
      text-decoration: underline;
      text-underline-offset: 2px;
    }
    .certs { display: grid; gap: 6px; margin-top: 6px; }
    .cert {
      font-size: 11px;
      line-height: 1.5;
      color: var(--text-muted);
      border: 1px solid #e5e7eb;
      padding: 8px 10px;
      border-radius: 12px;
      overflow-wrap: anywhere;
    }
    .cert a { color: var(--accent); text-decoration: underline; text-underline-offset: 2px; }

    @media (max-width: 800px) {
      body { padding: 12px; }
      .page { display: block; border-radius: 14px; }
      .left, .right { padding: 20px 18px 22px; }
    }
    @media print {
      body { background: white; padding: 0; }
      .page { box-shadow: none; border-radius: 0; max-width: 100%; }
      a { color: var(--accent); }
    }
  </style>
</head>
<body>
  <div class="page">
    <aside class="left">
      <div>
        <div class="name">${escapeHtml(fullName)}</div>
        <div class="role-line">${escapeHtml(headline)} ¬∑ ${escapeHtml(location)}</div>
        <div class="chip"><span class="chip-dot"></span> Disponible para roles junior / trainee</div>
      </div>

      <div>
        <div class="section-title">Contacto</div>
        <div class="contact-item"><div class="contact-icon">@</div><span>${escapeHtml(EMAIL)}</span></div>
        <div class="contact-item"><div class="contact-icon">in</div><span><a class="link" href="${escapeHtml(linkedinPretty)}" target="_blank" rel="noreferrer">LinkedIn</a></span></div>
        <div class="contact-item"><div class="contact-icon">{}</div><span><a class="link" href="${escapeHtml(LINKS.github)}" target="_blank" rel="noreferrer">GitHub</a></span></div>
        <div class="contact-item"><div class="contact-icon">ig</div><span><a class="link" href="${escapeHtml(LINKS.instagram)}" target="_blank" rel="noreferrer">Instagram</a></span></div>
        <div class="contact-item"><div class="contact-icon">sp</div><span><a class="link" href="${escapeHtml(LINKS.spotify)}" target="_blank" rel="noreferrer">Spotify</a></span></div>
      </div>

      <div>
        <div class="section-title">Skills clave</div>
        <div class="pill-list">
          ${skillsMerged.map((s) => `<span class="pill">${escapeHtml(s)}</span>`).join("")}
        </div>
      </div>

      <div>
        <div class="section-title">Certificaciones</div>
        <div class="kv">Cada certificaci√≥n incluye su link para abrirla en LinkedIn (si el JSON trae URL; si no, redirige a tu perfil).</div>
        <div class="certs">
          ${certs
          .map(
            (c) => `
            <div class="cert">
              <div><strong>${escapeHtml(c.name)}</strong> ¬∑ ${escapeHtml(c.authority)}</div>
              <div>Inicio: ${escapeHtml(c.startDate)} ¬∑ Fin: ${escapeHtml(c.endDate)}</div>
              <div><a href="${escapeHtml(c.link)}" target="_blank" rel="noreferrer">Ver en LinkedIn</a></div>
            </div>
          `
          )
          .join("")}
        </div>
      </div>
    </aside>

    <main class="right">
      <section class="block">
        <div class="section-title dark">Perfil</div>
        <p class="summary">${escapeHtml(summary)}</p>
      </section>

      <section class="block">
        <div class="section-title dark">Experiencia</div>
        ${exp
          .map(
            (e) => `
          <article>
            <div class="item-header">
              <div>
                <div class="item-title">${escapeHtml(e.title)}</div>
                <div class="item-subtitle">${escapeHtml(e.subtitle)}</div>
              </div>
              <div class="item-tag">Experiencia</div>
            </div>
            <div class="bullet-list">
              ${(e.bullets || []).map((b) => `<div class="bullet">${escapeHtml(b)}</div>`).join("")}
            </div>
          </article>
        `
          )
          .join("")}
      </section>

      <section class="block">
        <div class="section-title dark">Proyectos</div>
        ${proj
          .map(
            (p) => `
          <article>
            <div class="item-header">
              <div>
                <div class="item-title">${escapeHtml(p.title)}</div>
                <div class="item-subtitle">${escapeHtml(p.subtitle)}</div>
              </div>
              <span class="inline-badge">Impacto</span>
            </div>
            <div class="bullet-list">
              ${(p.bullets || []).map((b) => `<div class="bullet">${escapeHtml(b)}</div>`).join("")}
            </div>
          </article>
        `
          )
          .join("")}
      </section>

      <section class="block">
        <div class="section-title dark">Educaci√≥n</div>
        ${education
          .map(
            (ed) => `
          <article>
            <div class="item-header">
              <div>
                <div class="item-title">${escapeHtml(ed.title)}</div>
                <div class="item-subtitle">${escapeHtml(ed.subtitle)}</div>
              </div>
              <div class="item-tag">Formaci√≥n</div>
            </div>
            ${ed.note ? `<div class="bullet-list"><div class="bullet">${escapeHtml(ed.note)}</div></div>` : ""}
          </article>
        `
          )
          .join("")}
      </section>
    </main>
  </div>
</body>
</html>`;
    }

    function hydrateCvPreview() {
      const pop = $("#cv");
      if (!pop) return;

      const iframe = $("#cv-iframe");
      if (!iframe) return;

      const data = loadedProfile || fallback;
      const html = buildCvHtml(data);

      // Preview en iframe
      iframe.srcdoc = html;

      // Guardamos √∫ltimo HTML para imprimir/abrir
      iframe._cvHtml = html;
    }

    function openCvInNewTab(html) {
      const w = window.open("", "_blank", "noreferrer");
      if (!w) {
        toast("POPUP BLOQUEADO");
        return null;
      }
      w.document.open();
      w.document.write(html);
      w.document.close();
      return w;
    }

    // CV popover actions
    const popCv = $("#cv");
    $("#cv").addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-action]");
      if (!btn) return;
      if (btn.dataset.action === "close-cv") popCv.hidePopover();
    });

    $("#cv-print").addEventListener("click", () => {
      const iframe = $("#cv-iframe");
      const html = iframe?._cvHtml;
      if (!html) {
        toast("CV NO LISTO");
        return;
      }
      const w = openCvInNewTab(html);
      if (!w) return;
      // Print apenas carga
      w.addEventListener("load", () => w.print(), { once: true });
    });

    $("#cv-open-new").addEventListener("click", () => {
      const iframe = $("#cv-iframe");
      const html = iframe?._cvHtml;
      if (!html) {
        toast("CV NO LISTO");
        return;
      }
      openCvInNewTab(html);
    });

    // Keyboard shortcuts
    window.addEventListener("keydown", (e) => {
      const map = {
        "1": "about",
        "2": "stack",
        "3": "experience",
        "4": "projects",
        "5": "education",
        "6": "certs",
        "7": "contact",
        "8": "instagram",
        "9": "spotify",
      };

      if (map[e.key]) navigate(map[e.key]);

      if (e.key === "u" || e.key === "U") {
        const pop = $("#actions");
        pop.matches(":popover-open") ? pop.hidePopover() : pop.showPopover();
      }

      if (e.key === "m" || e.key === "M") {
        const pop = $("#memento");
        pop.matches(":popover-open") ? pop.hidePopover() : pop.showPopover();
      }

      if (e.key === "c" || e.key === "C") {
        const pop = $("#cv");
        if (pop.matches(":popover-open")) pop.hidePopover();
        else {
          pop.showPopover();
          hydrateCvPreview();
        }
      }

      if (e.key === "/") {
        e.preventDefault();
        $("#search").focus();
      }

      if (e.key === "Escape") {
        if (popActions.matches(":popover-open")) popActions.hidePopover();
        if (popMemento.matches(":popover-open")) popMemento.hidePopover();
        if (popCv.matches(":popover-open")) popCv.hidePopover();
      }
    });

    // Instagram/Spotify buttons
    $("#open-instagram").addEventListener("click", () => window.open(LINKS.instagram, "_blank", "noreferrer"));
    $("#open-spotify").addEventListener("click", () => window.open(LINKS.spotify, "_blank", "noreferrer"));

    $("#copy-instagram").addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(LINKS.instagram);
        toast("LINK COPIADO");
      } catch {
        toast("NO SE PUDO COPIAR");
      }
    });

    $("#copy-spotify").addEventListener("click", async () => {
      try {
        await navigator.clipboard.writeText(LINKS.spotify);
        toast("LINK COPIADO");
      } catch {
        toast("NO SE PUDO COPIAR");
      }
    });

    $("#open-cv-from-certs").addEventListener("click", () => {
      const pop = $("#cv");
      pop.showPopover();
      hydrateCvPreview();
    });

    // Init
    (async function init() {
      const data = await loadLinkedIn();
      loadedProfile = data;

      $("#name").textContent = `${data.firstName || ""} ${data.lastName || ""}`.trim() || "C√©sar Reyes";
      $("#headline").textContent = (data.headline || "Data ¬∑ IA ¬∑ Automatizaci√≥n").replace(/junior/gi, "").trim();
      $("#location").textContent = data.location || "Colombia";

      const summary = (data.summary || "").trim();
      $("#summary").textContent = summary || defaultSummary;

      if (data.publicProfileUrl) LINKS.linkedin = data.publicProfileUrl;

      allSkills = (data.skills || []).map((s) => ({ name: s.name || "" })).filter((s) => s.name);
      allCerts = (data.certifications || []).filter(Boolean);

      renderSkills(allSkills);
      renderCerts(allCerts);

      // Social UI
      $("#ig-link-text").textContent = LINKS.instagram;
      $("#sp-link-text").textContent = LINKS.spotify;

      ensureInstagramEmbed();
      setSpotifyEmbed();

      const start = (location.hash || "#about").replace("#", "");
      navigate(start, { pushHash: false });

      updateMemento(new Date());
      setInterval(() => updateMemento(new Date()), 1000);

      // Recalcular grid en resize (Memento) y refrescar embeds
      window.addEventListener("resize", () => {
        updateMemento(new Date());
        ensureInstagramEmbed();
      });

      // Cuando abras CV desde acciones/atajo, siempre armado con data actual.
      $("#cv").addEventListener("toggle", (ev) => {
        // toggle: true cuando se abre
        if (ev.newState === "open") hydrateCvPreview();
      });
    })();
  </script>
</body>

</html>